import { PlataFs } from '../libs/fs'
import path from 'node:path'

const main = async () => {
    const plataDir = path.resolve('.')

    // Copy assets folder
    {
        const srcAssetsFolder = path.join(plataDir, 'src', 'tests', 'assets')
        const buildAssetsFolder = path.join(plataDir, '__BUILD__', 'tests', 'assets')

        if (await PlataFs.access(buildAssetsFolder)) {
            await PlataFs.fs.rm(
                buildAssetsFolder, 
                { force: true, recursive: true, maxRetries: 1, retryDelay: 1 }
            )
        }

        await PlataFs.fs.mkdir(buildAssetsFolder, { recursive: true })

        const err = await PlataFs.cp(
            srcAssetsFolder,
            buildAssetsFolder,
            { force: true, recursive: true }
        )

        if (err !== null) {
            console.log(err)
            process.exit(1)
        }
    }
}

main()