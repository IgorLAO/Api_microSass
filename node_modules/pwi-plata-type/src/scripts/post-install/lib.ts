import { PlataFs } from "++/libs/fs"

export async function install(tools: PlataFs.CliTools, projectPackageJson: any) {
    const promises: Promise<void>[] = []

    promises.push(tools.createFolderToDest('clusters'))
    promises.push(tools.createFolderToDest('libs'))
    promises.push(tools.createFolderToDest('@types'))
    promises.push(tools.createFolderToDest('bin'))
    promises.push(tools.createFolderToDest('configs'))

    promises.push(tools.syncFileToDest('postinstall.js')) // TODO :: compilar esse cara ou colocar como um bin na plata mesmo
    promises.push(tools.syncFileToDest('postinstall-tools.mjs'))
    promises.push(tools.syncFileToDest('tsconfig.json'))

    projectPackageJson.type = "module"
    projectPackageJson.scripts.create = 'plata-runtime + plata-create'
    projectPackageJson.scripts.postinstall = "node postinstall.js"

    projectPackageJson.main = undefined

    await Promise.all(promises)

    return projectPackageJson

}