import { describe, it, before } from "node:test"
import assert from "node:assert"
import { PlataRoutes } from ".."
import { loadRuntimeLibs } from "../bin/runtime/_setupRuntime"


describe('Plata Switch', () => {
    const plataPromise = (async () => {
        const g = global as any
    
        g.Plata = await loadRuntimeLibs()
    })()

    const exports = { default: async (r) => r }

    before(async () => {
        await plataPromise
    })

    it('Ordem dos index', async () => {
        const routes = PlataRoutes.processRoutes([
            {
                exports,
                filePath: '/v1/controle/index.js',
                name: 'index'
            },
            {
                exports,
                filePath: '/v1/controle/update.js',
                name: 'update'
            },
            {
                exports,
                filePath: '/v1/index.js',
                name: 'index'
            },
        ])

        assert.deepStrictEqual(routes.map(r => r.httpRoute), [
            '/v1/',
            '/v1/controle/',
            '/v1/controle/update',
        ])
    })
})