"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModelTemplateEnv = void 0;
const tools_1 = require("./tools");
class ModelTemplateEnv {
    template;
    validations = [];
    type;
    constructor(template) {
        this.template = template;
    }
    addValidation(callback) {
        this.validations.push(callback);
    }
    async validate(value) {
        let errors = await tools_1.ModelsInternals.validateTemplateEnv(value, this.template);
        if (errors.errorID !== undefined) {
            return {
                errors: [errors],
                value: undefined
            };
        }
        if (errors.length !== 0) {
            return {
                errors,
                value: undefined
            };
        }
        const promises = [];
        for (let i = this.validations.length - 1; i >= 0; i--) {
            const validation = this.validations[i];
            promises.push(Plata.FastPromise(() => validation(value)));
        }
        errors = (await Promise.all(promises)).filter(Boolean);
        if (errors.length !== 0) {
            return {
                errors,
                value: undefined
            };
        }
        return {
            value: value,
            errors: undefined
        };
    }
}
exports.ModelTemplateEnv = ModelTemplateEnv;
//# sourceMappingURL=model-template-env.js.map